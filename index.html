<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Graficador lineal OFF‑LINE</title>
<style>
  body{font-family:Arial,sans-serif;background:#f4f4f5;margin:0;padding:20px;display:flex;flex-direction:column;align-items:center;gap:14px}
  h1{margin:0;font-size:22px;font-weight:700}
  .btn{background:#374151;color:#fff;padding:6px 14px;border:none;border-radius:6px;font-weight:600;cursor:pointer}
  .btn:hover{background:#1f2937}
  .mv{width:34px;height:34px;display:flex;align-items:center;justify-content:center;font-weight:700}
  #canvas{border:1px solid #000;border-radius:8px;cursor:grab;touch-action:none;background:#fff}
  #canvas:active{cursor:grabbing}
  .grid2{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;max-width:680px;width:100%}
  input{padding:6px;border:1px solid #ccc;border-radius:6px;width:100%}
</style>
</head>
<body>
  <h1>Graficador de desigualdades (offline ligero)</h1>

  <div id="inputs" class="grid2"></div>
  <button id="add" class="btn" style="background:#16a34a">+ desigualdad</button>

  <div style="display:flex;gap:8px;align-items:center">
    <button id="draw" class="btn" style="background:#2563eb">Graficar</button>
    <button id="zin"  class="btn">+</button>
    <button id="zout" class="btn">−</button>
    <div style="display:grid;grid-template-columns:repeat(3,34px);gap:0;user-select:none">
      <div></div><button class="btn mv" data-mv="up">▲</button><div></div>
      <button class="btn mv" data-mv="left">◀</button><button class="btn mv" data-mv="re">⌖</button><button class="btn mv" data-mv="right">▶</button>
      <div></div><button class="btn mv" data-mv="down">▼</button><div></div>
    </div>
  </div>

  <canvas id="canvas" width="1200" height="720"></canvas>

<script>
/* ---------- utilidades ---------- */
const C=document.getElementById('canvas');const ctx=C.getContext('2d');
let SCALE=40, ORG={x:C.width/2,y:C.height/2};
const toPix=(x,y)=>({x:ORG.x+x*SCALE,y:ORG.y-y*SCALE});
const toCoord=(px,py)=>({x:(px-ORG.x)/SCALE,y:(ORG.y-py)/SCALE});
const COLORS=['#ef4444','#3b82f6','#10b981','#f59e0b','#8b5cf6','#ec4899'];

function addInput(){inputs.insertAdjacentHTML('beforeend',`<input class="ineq" placeholder="4*x+2*y<=100"/>`);} // simple
for(let i=0;i<3;i++)addInput();

document.getElementById('add').onclick=addInput;

/* Parseo lineal ax+by op c */
function parseIneq(str){str=str.replace(/\s+/g,'');const m=str.match(/(.+)(<=|>=|<|>|=)(.+)/);if(!m)throw'Formato inválido: '+str;const left=m[1],op=m[2],right=Number(m[3]);
  const coef=exprToCoef(left);return{raw:str,a:coef.a,b:coef.b,c:right,op,color:COLORS.shift()||'#000',test:(x,y)=>cmp(coef.a*x+coef.b*y,op,right)};}
function exprToCoef(exp){let a=0,b=0;exp=exp.replace(/-/g,'+-');const terms=exp.split('+').filter(Boolean);
  terms.forEach(t=>{if(t.includes('x')){a+=numCoef(t,'x');}else if(t.includes('y')){b+=numCoef(t,'y');}else{a+=0;}});
  return{a,b};}
function numCoef(term,varChar){term=term.replace(varChar,'');if(term==''||term=='+')return 1;if(term=='-')return -1;return Number(term);} 
function cmp(val,op,c){switch(op){case'<=':return val<=c+1e-9;case'>=':return val>=c-1e-9;case'<':return val<c;case'>':return val>c;default:return Math.abs(val-c)<1e-9;}}

/* graficar */
function drawGrid(){ctx.clearRect(0,0,C.width,C.height);ctx.lineWidth=1;ctx.strokeStyle='#e5e7eb';for(let x=ORG.x%SCALE;x<C.width;x+=SCALE){ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,C.height);ctx.stroke();}
  for(let y=ORG.y%SCALE;y<C.height;y+=SCALE){ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(C.width,y);ctx.stroke();}
  ctx.strokeStyle='#000';ctx.beginPath();ctx.moveTo(0,ORG.y);ctx.lineTo(C.width,ORG.y);ctx.moveTo(ORG.x,0);ctx.lineTo(ORG.x,C.height);ctx.stroke();
  ctx.font='10px Arial';ctx.fillStyle='#000';for(let i=-C.width/SCALE;i<C.width/SCALE;i++){const p=toPix(i,0);if(p.x>0&&p.x<C.width)ctx.fillText(i,p.x+2,ORG.y+12);}for(let j=-C.height/SCALE;j<C.height/SCALE;j++){const p=toPix(0,j);if(p.y>0&&p.y<C.height)ctx.fillText(j,p.x+4,p.y-2);} }

function shade(reg){const img=ctx.createImageData(C.width,C.height);const d=img.data;const step=6;for(let px=0;px<C.width;px+=step)for(let py=0;py<C.height;py+=step){const {x,y}=toCoord(px,py);if(reg.every(f=>f.test(x,y))){for(let dx=0;dx<step;dx++)for(let dy=0;dy<step;dy++){const id=((py+dy)*C.width+px+dx)*4;d[id]=255;d[id+1]=255;d[id+2]=170;d[id+3]=70;}}}ctx.putImageData(img,0,0);} // más ligero + transparente

function drawLines(reg){reg.forEach(r=>{ctx.strokeStyle=r.color;ctx.lineWidth=2;ctx.beginPath();let first=true,endPt=null;for(let px=0;px<C.width;px++){let found=false;for(let py=0;py<C.height;py++){const {x,y}=toCoord(px,py);if(Math.abs(r.a*x+r.b*y-r.c)<1e-2){const p={x:px,y:py};if(first){ctx.moveTo(p.x,p.y);first=false;}else ctx.lineTo(p.x,p.y);endPt=p;found=true;break;}}}ctx.stroke();if(endPt){ctx.fillStyle=r.color;ctx.font='12px Arial';ctx.fillText(r.raw,endPt.x+6,endPt.y-6);} });}

function findVerts(reg){const pts=[];for(let i=0;i<reg.length;i++)for(let j=i+1;j<reg.length;j++){const d=reg[i].a*reg[j].b-reg[j].a*reg[i].b;if(Math.abs(d)<1e-9)continue;const x=(reg[i].c*reg[j].b-reg[j].c*reg[i].b)/d;const y=(reg[i].a*reg[j].c-reg[j].a*reg[i].c)/d; if(isFinite(x)&&isFinite(y)&&reg.every(f=>f.test(x,y)))pts.push({x:round(x),y:round(y)});} drawVerts(pts);}function round(v){return Math.round(v*100)/100;}
function drawVerts(pts){pts.forEach(p=>{const pix=toPix(p.x,p.y);ctx.beginPath();ctx.fillStyle='#000';ctx.arc(pix.x,pix.y,3,0,Math.PI*2);ctx.fill();ctx.fillText(`(${p.x},${p.y})`,pix.x+5,pix.y-5);} );}

function plot(){try{const arr=[...document.querySelectorAll('.ineq')].map(i=>i.value.trim()).filter(Boolean).map(parseIneq);drawGrid();shade(arr);drawLines(arr);findVerts(arr);}catch(e){alert(e);}}

document.getElementById('draw').onclick=plot;document.getElementById('zin').onclick=()=>{SCALE=Math.min(SCALE+10,120);plot();};document.getElementById('zout').onclick=()=>{SCALE=Math.max(SCALE-10,10);plot();};

document.querySelectorAll('[data-mv]').forEach(b=>b.onclick=()=>{const s=40;switch(b.dataset.mv){case'up':ORG.y+=s;break;case'down':ORG.y-=s;break;case'left':ORG.x+=s;break;case'right':ORG.x-=s;break;default:ORG={x:C.width/2,y:C.height/2};}plot();});
let drag=false,start={},base={};C.onpointerdown=e=>{drag=true;start={x:e.clientX,y:e.clientY};base={...ORG};C.setPointerCapture(e.pointerId);};C.onpointermove=e=>{if(!drag)return;ORG.x=base.x+(e.clientX-start.x);ORG.y=base.y+(e.clientY-start.y);plot();};C.onpointerup=()=>drag=false;C.onwheel=e=>{e.preventDefault();SCALE=Math.max(10,Math.min(120,SCALE+(e.deltaY>0?-10:10)));plot();};

drawGrid();
</script>
</body>
</html>

